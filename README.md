# XML Parser and SFTP Upload/Download Project

This project provides tools to download XML files from an SFTP server, parse these XML files into structured CSV format, and then upload the parsed CSVs back to the SFTP server. The files in the SFTP server are WD reports that automatically update nightly.  They are named with the .csv extension, but are actually XML files that need to be parsed before their parsed versions are uploaded into the 'parsed_csv_uploads' directory.  From this directory, they are retreived from the Azure data facotry and ingested as staging tables.

## Project Structure

*   `Workday XML Downloads/`: This directory is the designated location for storing raw XML input files downloaded from the SFTP server. The parser scripts will read files from here.
*   `Parsing Scripts/`: Contains all the Python scripts used for parsing the XML files.
*   `Parsed CSVs/`: This directory stores the structured CSV files generated by the parser scripts. These are the files that will be uploaded back to the SFTP server.
*   `config.ini`: A central configuration file located in the project root. It defines:
    *   Paths for XML input (`Workday XML Downloads/`), CSV output (`Parsed CSVs/`), and the parsing scripts themselves.
    *   SFTP server connection details (Hostname, Port, Username, Password).
*   `download_sftp_files.py`: (Located in the root) This script connects to an SFTP server (using credentials from `config.ini`) and downloads all files from the SFTP server's root directory into the `Workday XML Downloads/` folder.
*   `upload_parsed_files_to_sftp.py`: (Located in the root) This script connects to the SFTP server (using credentials from `config.ini`) and uploads all files from the local `Parsed CSVs/` directory to a specified directory (e.g., `/parsed_csv_uploads/`) on the SFTP server.
*   `analyze_xml_structure.py`: (Located in the root) This script is likely used to analyze the structure of an XML file, helping to understand its schema, tags, and overall organization. This is often a preliminary step before writing a dedicated parser.
*   `README.md`: This file, providing an overview of the project.

## Workflow Overview

The project typically follows this workflow:

### 1. SFTP File Download

*   **Script**: `download_sftp_files.py`
*   **Purpose**: To retrieve the latest XML data files from the SFTP server.
*   **Process**:
    1.  Reads SFTP connection details and the target local download directory (`Workday XML Downloads/`) from `config.ini`.
    2.  Connects to the specified SFTP server.
    3.  Downloads all files from the root directory of the SFTP server into the local `Workday XML Downloads/` folder.
*   **Prerequisites**: The `pysftp` library must be installed (`pip install pysftp`).
*   **Security Notes**: Refer to notes within the script regarding host key verification and plain text password storage in `config.ini`.

### 2. XML Parsing

*   **Scripts**: Located in the `Parsing Scripts/` directory.
*   **Purpose**: To convert the downloaded XML files into a structured, tabular CSV format.
*   **Process**:
    1.  A specific parser script is executed.
    2.  The script reads `config.ini` for input (`Workday XML Downloads/`) and output (`Parsed CSVs/`) directory paths.
    3.  It parses the corresponding XML file from the input directory.
    4.  Relevant data is extracted.
    5.  The extracted data is written to a new CSV file in the `Parsed CSVs/` directory.

### 3. SFTP Parsed File Upload

*   **Script**: `upload_parsed_files_to_sftp.py`
*   **Purpose**: To upload the processed CSV files back to the SFTP server for use by other systems or for archival.
*   **Process**:
    1.  Reads SFTP connection details and the local source directory (`Parsed CSVs/`) from `config.ini`.
    2.  Connects to the specified SFTP server.
    3.  Uploads all files from the local `Parsed CSVs/` directory to a predefined target directory on the SFTP server (e.g., `/parsed_csv_uploads/`). The script will attempt to create this remote directory if it doesn't exist.
*   **Prerequisites**: The `pysftp` library must be installed.
*   **Security Notes**: Same as for the download script regarding host keys and password storage.

## Parser Scripts (in `Parsing Scripts/` directory)

*   `xml_parser_position_master.py`: Parses `position_master.csv` and outputs `parsed_position_master.csv`.
*   `xml_parser_costing_allocations_daily.py`: Parses `position_costing_allocations_daily.csv` and outputs `parsed_position_costing_allocations_daily.csv`.
*   `xml_parser_position_compensation.py`: Parses `position_compensation.csv` and outputs `parsed_position_compensation.csv`.
*   `xml_parser_worktag_program.py`: Parses `worktag_program.csv` and outputs `parsed_worktag_program.csv`.
*   `xml_parser_worktag_grant.py`: Parses `worktag_grant.csv` and outputs `parsed_worktag_grant.csv`.

This setup allows for a complete cycle of downloading, processing, and uploading XML data, with a centralized configuration for managing file paths and SFTP credentials. 